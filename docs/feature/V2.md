# V2: Cloud, Auth & Paid Tier

## Overview
V2 introduces a "Freemium" model where the app remains fully functional offline (free), but offers Cloud Sync and Backup features for signed-in users (paid/pro).

## Core Philosophy
- **Local First**: The app must always work without an account.
- **Progressive Enhancement**: Cloud features unlock *on top* of the local experience.

## Storage Strategy
We will use a **Hybrid Storage** approach:

1.  **Guest (Free)**:
    - Storage: `localStorage` (via Zustand).
    - Limit: Browser storage limits only.
    - Risk: Data loss if browser cache is cleared.
    - Features: Create, Edit, PDF, PWA Offline.

2.  **Pro (Authenticated)**:
    - Storage: **Convex DB**.
    - Sync: Real-time across devices.
    - Migration: When a Guest logs in, their local invoices are uploaded to Convex and then local storage is cleared (or kept as cache).
    - Features: Cloud Backup, Multi-device, Team sharing.

## Feature Gates
| Feature | Guest (Free) | Pro (Auth) |
| :--- | :--- | :--- |
| Create Invoices | ✅ | ✅ |
| PDF Export | ✅ | ✅ |
| Themes | ✅ | ✅ |
| **Cloud Sync** | ❌ | ✅ |
| **Client Database** | Local Only | Global (Synced) |
| **Templates** | Local Only | Global (Synced) |

## Implementation Details

### 1. Dual-Mode Hook
We need a unified hook `useInvoices()` that abstracts the data source:

```typescript
function useInvoices() {
  const { isAuthenticated } = useAuth();
  const localStore = useLocalStore();
  const convexQuery = useQuery(api.invoices.list);

  if (isAuthenticated) {
    return { data: convexQuery, source: 'cloud' };
  } else {
    return { data: localStore.invoices, source: 'local' };
  }
}
```

### 2. Onboarding / Upsell
- **"Save to Cloud"** button in the header.
- **"Login to Sync"** banner on the dashboard.
- Sync Conflict resolution: If a user logs in and has local data *and* cloud data, prompt to merge.

